version: '3.8'

services:
  # Neo4j 서비스 제거됨 - Supabase Cloud 사용
  # 이전 Neo4j 설정은 마이그레이션 전 백업용으로 주석 처리
  #
  # neo4j:
  #   image: neo4j:5.15-community
  #   container_name: lecpin-neo4j
  #   ports:
  #     - '7474:7474' # HTTP
  #     - '7687:7687' # Bolt
  #   environment:
  #     - NEO4J_AUTH=neo4j/localpassword123
  #     - NEO4J_PLUGINS=["apoc", "graph-data-science"]
  #     - NEO4J_dbms_security_procedures_unrestricted=apoc.*,gds.*
  #     - NEO4J_dbms_memory_heap_initial__size=512m
  #     - NEO4J_dbms_memory_heap_max__size=2G
  #     - NEO4J_dbms_memory_pagecache_size=512m
  #   volumes:
  #     - neo4j_data:/data
  #     - neo4j_logs:/logs
  #     - neo4j_import:/var/lib/neo4j/import
  #     - neo4j_plugins:/plugins
  #     - ./scripts/neo4j-init:/docker-entrypoint-initdb.d
  #   healthcheck:
  #     test:
  #       ['CMD-SHELL', "cypher-shell -u neo4j -p localpassword123 'RETURN 1'"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5

  nextjs:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: lecpin-nextjs
    ports:
      - '3000:3000'
    environment:
      # Supabase 환경변수
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      # OpenAI API
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      # Application
      - NODE_ENV=production
    # Neo4j depends_on 제거됨

# Neo4j 볼륨 제거됨
# volumes:
#   neo4j_data:
#   neo4j_logs:
#   neo4j_import:
#   neo4j_plugins:
